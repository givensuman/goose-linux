---
name: "Pull Request Checks"
on:
  pull_request:
    branches:
      - main
      - dev
  workflow_dispatch:

jobs:
  lint-scripts:
    name: Lint Shell Scripts
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Check Just Syntax
        uses: ublue-os/just-action@v2
        with:
          command: lint

  check-just-syntax:
    name: Check Just Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Check Just Syntax
        uses: ublue-os/just-action@v2
        with:
          command: check

  build-container:
    name: Build Container Image
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: read
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Build Container
        run: |
          podman build --tag localhost/goose-linux:pr-test .

      - name: Inspect Image
        run: |
          podman inspect localhost/goose-linux:pr-test

  summary:
    name: Summary
    runs-on: ubuntu-latest
    needs: [lint-scripts, check-just-syntax, build-container]
    if: always()
    steps:
      - name: Check Results
        run: |
          if [ "${{ needs.lint-scripts.result }}" != "success" ] || \
             [ "${{ needs.check-just-syntax.result }}" != "success" ] || \
             [ "${{ needs.build-container.result }}" != "success" ]; then
            echo "Some checks failed"
            exit 1
          fi
          echo "âœ… All checks passed!"
